{{/*
 Config Format Version

 Whenever a breaking change is made to the semantics of this configuration file, the configuration version
 expected by the router will be incremented. When the controller tries to load a configuration file with
 an incompatible version, it will abort with a message prompting the operator to seek out the breaking changes
 documentation.*/}}
v: 3

identity:
  cert:                 "{{ .ZitiPKI }}/certs/{{ .RouterName }}-client.cert"
  server_cert:          "{{ .ZitiPKI }}/certs/{{ .RouterName }}-server.cert"
  key:                  "{{ .ZitiPKI }}/keys/{{ .RouterName }}-server.key"
  ca:                   "{{ .ZitiPKI }}/certs/{{ .RouterName }}-cas.cert"

ctrl:
  endpoint:             tls:{{ .ZitiCtrlHostname }}:{{ .ZitiFabCtrlPort }}

link:
{{ if .IsPrivate }}#{{ end }}  listeners:
{{ if .IsPrivate }}#{{ end }}    - binding:          transport
{{ if .IsPrivate }}#{{ end }}      bind:             tls:0.0.0.0:{{ .ListenerBindPort }}
{{ if .IsPrivate }}#{{ end }}      advertise:        tls:{{ .ZitiEdgeRouterHostname }}:{{ .ListenerBindPort }}
{{ if .IsPrivate }}#{{ end }}      options:
{{ if .IsPrivate }}#{{ end }}        outQueueSize:   {{ .OutQueueSize }}
  dialers:
    - binding: transport

listeners:
{{ if or .IsFabricRouter .IsPrivate }}#{{- end }}  - binding: tunnel
{{ if or .IsFabricRouter .IsPrivate }}#{{- end }}    options:
{{ if or .IsFabricRouter .IsPrivate }}#{{- end }}      mode: host #tproxy|tun|host
{{ if .IsPrivate }}#{{ end }}  - binding: {{- if or .IsFabricRouter .IsPrivate }}transport{{ else }}edge{{ end }}
{{ if .IsPrivate }}#{{ end }}    address: {{if .WssEnabled}}ws{{else}}tls{{end}}:0.0.0.0:{{if .WssEnabled}}3023{{else}}{{ .ZitiEdgeRouterPort }}{{end}}
{{ if .IsPrivate }}#{{ end }}    options:
{{ if .IsPrivate }}#{{ end }}      advertise: {{ .ZitiEdgeRouterHostname }}:{{if .WssEnabled}}3023{{else}}{{ .ZitiEdgeRouterPort }}{{end}}
{{ if .IsPrivate }}#{{ end }}      connectTimeoutMs: {{ .ConnectTimeoutMs }}
{{ if .IsPrivate }}#{{ end }}      getSessionTimeout: {{ .GetSessionTimeoutS }}s


{{- if or .IsPrivate .IsFabricRouter }}
#edge:
csr:
  country: US
  province: NC
  locality: Charlotte
  organization: NetFoundry
  organizationalUnit: Ziti
  sans:
    dns:
      - {{ .ZitiEdgeRouterHostname }}
      - localhost
    ip:
      - "127.0.0.1"
{{- else }}
edge:
  csr:
    country: US
    province: NC
    locality: Charlotte
    organization: NetFoundry
    organizationalUnit: Ziti
    sans:
      dns:
        - {{ .ZitiEdgeRouterHostname }}
        - localhost
      ip:
        - "127.0.0.1"
{{ end }}

{{ if not .WssEnabled }}#{{ end }}transport:
{{ if not .WssEnabled }}#{{ end }}  ws:
{{ if not .WssEnabled }}#{{ end }}    writeTimeout: {{ .WssWriteTimeout }}
{{ if not .WssEnabled }}#{{ end }}    readTimeout: {{ .WssReadTimeout }}
{{ if not .WssEnabled }}#{{ end }}    idleTimeout: {{ .WssIdleTimeout }}
{{ if not .WssEnabled }}#{{ end }}    pongTimeout: {{ .WssPongTimeout }}
{{ if not .WssEnabled }}#{{ end }}    pingInterval: {{ .WssPingInterval }}
{{ if not .WssEnabled }}#{{ end }}    handshakeTimeout: {{ .WssHandshakeTimeout }}
{{ if not .WssEnabled }}#{{ end }}    readBufferSize: {{ .WssReadBufferSize }}
{{ if not .WssEnabled }}#{{ end }}    writeBufferSize: {{ .WssWriteBufferSize }}
{{ if not .WssEnabled }}#{{ end }}    enableCompression: true
{{ if not .WssEnabled }}#{{ end }}    server_cert: {{ .ZitiPKI }}/certs/{{ .RouterName }}-router-server.cert
{{ if not .WssEnabled }}#{{ end }}    key: {{ .ZitiPKI }}/keys/{{ .RouterName }}-router-server.key

forwarder:
  latencyProbeInterval: {{ .LatencyProbeInterval }}
  xgressDialQueueLength: {{ .XgressDialQueueLength }}
  xgressDialWorkerCount: {{ .XgressDialWorkerCount }}
  linkDialQueueLength: {{ .LinkDialQueueLength }}
  linkDialWorkerCount: {{ .LinkDialWorkerCount }}